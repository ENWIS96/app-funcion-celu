<ion-header [translucent]="true">
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Conectar Dispositivo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="bluetooth-container">
    <div class="info-section">
      <ion-icon name="desktop" class="page-icon"></ion-icon>
      <h2>Conectar con PC</h2>
      <p>Busca y conéctate al dispositivo receptor</p>
    </div>

    <!-- Estado de Bluetooth -->
    <div class="status-card">
      <div class="status-item">
        <ion-icon [name]="isBluetoothEnabled ? 'bluetooth' : 'power'" 
                  [class.enabled]="isBluetoothEnabled"
                  [class.disabled]="!isBluetoothEnabled"></ion-icon>
        <span>Bluetooth: {{ isBluetoothEnabled ? 'Activado' : 'Desactivado' }}</span>
      </div>
      <div class="status-item" *ngIf="isScanning">
        <ion-icon name="radio-button-on" class="scanning"></ion-icon>
        <span>Escaneando dispositivos...</span>
      </div>
    </div>

    <!-- Botón para activar Bluetooth -->
    <ion-button expand="block" (click)="enableBluetooth()" *ngIf="!isBluetoothEnabled" color="warning" class="action-button">
      <ion-icon slot="start" name="power"></ion-icon>
      Activar Bluetooth
    </ion-button>

    <!-- Botones de escaneo -->
    <ion-button expand="block" (click)="startScan()" [disabled]="isScanning || !isBluetoothEnabled" color="warning" class="action-button">
      <ion-icon slot="start" name="scan"></ion-icon>
      {{ isScanning ? 'Buscando dispositivos...' : 'Buscar Dispositivos' }}
    </ion-button>

    <ion-button expand="block" (click)="stopScan()" [disabled]="!isScanning" fill="outline" color="warning" class="action-button">
      <ion-icon slot="start" name="stop-circle"></ion-icon>
      Detener Búsqueda
    </ion-button>

    <!-- Lista de dispositivos -->
    <div class="devices-section">
      <h3>Dispositivos Encontrados ({{ devices.length }})</h3>
      <div class="devices-list" *ngIf="devices.length > 0">
        <ion-card *ngFor="let device of devices" class="device-card" [class.connected]="isConnected(device.device.deviceId)">
          <ion-card-content>
            <div class="device-info">
              <ion-icon [name]="isConnected(device.device.deviceId) ? 'bluetooth' : 'phone-portrait'"></ion-icon>
              <div class="device-details">
                <h4>{{ getDeviceName(device) }}</h4>
                <p class="signal-strength" *ngIf="device.rssi">
                  Señal: {{ device.rssi }} dBm
                </p>
              </div>
            </div>
            
            <!-- Botones de acción -->
            <div class="device-actions">
              <ion-button 
                *ngIf="!isConnected(device.device.deviceId)"
                size="small" 
                (click)="pairDevice(device)"
                color="primary">
                <ion-icon slot="start" name="link"></ion-icon>
                Emparejar
              </ion-button>
              
              <ion-button 
                *ngIf="isConnected(device.device.deviceId)"
                size="small" 
                (click)="disconnectDevice(device)"
                color="danger"
                fill="outline">
                <ion-icon slot="start" name="close-circle"></ion-icon>
                Desconectar
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
      <div class="no-devices" *ngIf="devices.length === 0">
        <ion-icon name="bluetooth-outline"></ion-icon>
        <p *ngIf="!isBluetoothEnabled">Activa el Bluetooth para escanear dispositivos</p>
        <p *ngIf="isBluetoothEnabled && !isScanning">Presiona "Iniciar Escaneo" para buscar dispositivos</p>
        <p *ngIf="isScanning">Buscando dispositivos cercanos...</p>
      </div>
    </div>
  </div>
</ion-content>
